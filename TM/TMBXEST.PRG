******************************************************
* bop TMBXEST.PRG                                    *
* AUTORES: ANA PAULA, DANIELLE, EVERTON, LUIZ        *
* OBJETIVO: PERMITIR A BAIXA DE PRODUTOS EM ESTOQUE  *
* DATA: 29/09/94                                     *
******************************************************
SELE 1
   USE TMBEST INDEX TMIEST
SELE 2
   USE TMBBEST
SELE 3
   USE TMBLCD
SOMBRA(5,5,20,77,.F.)
@ 05,20 SAY "BAIXAS DE ESTOQUE"
@ 07,07 SAY "CODIGO DO ESTOQUE..:"
@ 09,07 SAY "DESCRI€O..........:"
@ 11,07 SAY "VALOR UNITARIO.....:"
@ 13,07 SAY "QUANTIDADE.........:"
@ 15,07 SAY "VALOR TOTAL........:"
SAVE SCREEN TO TELAEST
DO WHILE .T.
   SELE 1
   RESTORE SCREEN FROM TELAEST
   MCODEST  = 0
   MDESC    = SPACE(35)
   MVALUNIT = 0
   MQUANT   = 0
   MVALTOT  = 0
   @ 07,27 GET MCODEST PICT "9999"
   READ
   IF EMPTY(MCODEST) .AND. LASTKEY() = 13
      TABELA()
      IF EMPTY(MCODEST)
         LOOP
      ENDIF
      @ 07,27 GET MCODEST PICT "9999"
      CLEAR GETS
   ELSEIF EMPTY(MCODEST) .AND. LASTKEY() = 27
      EXIT
   ENDIF
   SEEK MCODEST
   IF .NOT. FOUND()
      @ 19,15 SAY "ESTOQUE INEXISTENTE - PRESSIONE ALGO PARA CONTINUAR"
      INKEY(0)
      LOOP
   ENDIF
   @ 09,27 GET DESC 
   @ 11,27 GET VALUNIT PICT "999,999.99"
   CLEAR GETS
   @ 13,27 GET MQUANT PICT "9999"
   READ
   M_QUANT = QUANT
   MQTMIN  = QTMIN
   IF MQUANT > (M_QUANT - MQTMIN)
      @ 19,15 SAY "QUANTIDADE INSUFICIENTE NO ESTOQUE - TECLE ALGO"
      INKEY(0)
      LOOP
   ENDIF
   MVALTOT = MQUANT * VALUNIT
   @ 15,27 GET MVALTOT PICT "999,999.99"
   CLEAR GETS
   INKEY(4)
   IF .NOT. CONFIRMA("REGISTRAR BAIXA?")
      LOOP
   ENDIF
   STOT = 0
   STOT = QUANT - MQUANT
   REPLACE QUANT  WITH STOT
   SELE 2
   APPEND BLANK
   REPLACE CODEST WITH MCODEST
   REPLACE DATAB  WITH DATA_SIS
   REPLACE QTD    WITH MQUANT
   REPLACE VALOR  WITH MVALTOT
   SELE 3
   APPEND BLANK
   REPLACE TIPO  WITH "C"
   REPLACE DESC  WITH "VENDA DE MATERIAL EM ESTOQUE"
   REPLACE VALOR WITH MVALTOT
   IF .NOT. CONFIRMA("DESEJA CONTINUAR?")
      EXIT
   ENDIF
ENDDO
CLOSE ALL
RETURN

         	

