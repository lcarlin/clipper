*********************************************************
* bop TMFCM                                             *
* AUTORES: ANA PAULA. DANIELLE, EVERTON, LUIZ           *
* OBJETIVO: PERMITIR O FECHAMENTO MENSAL DO CAIXA       *
* DATA: 28/09/94                                        *
*********************************************************
SELE 1
USE TMBLMC
SELE 2
USE TMBFUN INDEX TMIFUN
SELE 3
USE TMBCOM
SELE 4
USE TMBCOM2
IF .NOT. CONFIRMA(" DESEJA MESMO REALIZAR O FECHAMENTO MENSAL")
    CLOSE ALL
    RETURN
ENDIF
ACD   = 0
ACC   = 0
TOTAL = 0
SELE 1
SUM ALL TOTDIA TO ACC FOR TIPO = "C"
SUM ALL TOTDIA TO ACD FOR TIPO = "D"
TOTAL = ACC - ACD
IF TOTAL <> 0
   IF ACC > ACD
      MTIPO = "C"
   ELSE
      MTIPO = "D"
      TOTAL = TOTAL *(-1)
   ENDIF
ELSE
   MTIPO = " "
ENDIF
SOMBRA(7,20,17,55,.F.)
@ 08,26 SAY "POSIÄèO DO CAIXA NO MES"
@ 10,21 SAY "DEBITO...: " GET ACD   PICT "999,999.99"
@ 12,21 SAY "CREDITO..: " GET ACC   PICT "999,999.99"
@ 14,21 SAY "TOTAL....: " GET TOTAL PICT "999,999.99"
@ 16,21 SAY "SITUAÄèO.: " GET MTIPO
INKEY(0)
IF .NOT. CONFIRMA("CONFIRMA FECHAMENTO?")
    CLOSE ALL
    RETURN
ENDIF
ZAP
APPEND BLANK
REPLACE TOTDIA WITH TOTAL
REPLACE TIPO   WITH MTIPO
REPLACE DIA    WITH DATA_SIS
SELE 2
GO TOP
NUM = RECCOUNT()
DECLARE VET[NUM], VET2[NUM], VET3[NUM]
FOR I = 1 TO NUM
   VET [I] = CODFUN
   VET2[I] = NOMEFUN
   SKIP
NEXT
SELE 3
GO TOP
FOR K = 1 TO NUM
   SET FILTER TO CODF = VET[k]
   GO TOP
   AC = 0
   DO WHILE .NOT. EOF()
      AC=AC+VALOR
      SKIP
   ENDDO
   VET3[K] = AC
   SET FILTER TO
NEXT
ZAP
FOR L = 1 TO NUM
    APPEND BLANK
    REPLACE CODF  WITH VET[L]
    REPLACE VALOR WITH VET3[L]
    REPLACE DATAC WITH DATA_SIS
    REPLACE NOMEF WITH VET2[L]
NEXT
clear gets
CLOSE ALL
RETURN

* eop tmfcm