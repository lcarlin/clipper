************************************************************
* bop TMRPEST                                              *
* AUTORES: ANA PAULA, DANIELLE, EVERTON, LUIZ              *
* OBJETIVO: PERMITIR A REPOSICAO DE ESTOQUE                *
* DATA: 29/09/94                                           *
************************************************************
SELE 1
   USE TMBEST INDEX TMIEST
REINDEX
SELE 2
   USE TMBREST
SELE 3 
   USE TMBLCD
SOMBRA(5,5,20,75,.F.)
@ 05,20 SAY "REPOSIÄèO DE ESTOQUE"
@ 07,07 SAY "CODIGO DO ESTOQUE..:"
@ 09,07 SAY "DESCRIÄèO..........:"
@ 11,07 SAY "VALOR UNITARIO.....:"
@ 13,07 SAY "QUANTIDADE ........:"
@ 15,07 SAY "QUANTIDADE ATUAL...:"
SAVE SCREEN TO TELAEST
DO WHILE .T.
   SELE 1
   RESTORE SCREEN FROM TELAEST
   MCODEST  = 0
   MDESC    = SPACE(35)
   MVALUNIT = 0
   M_QUANT  = 0
   MQUANT   = 0
   @ 07,27 GET MCODEST PICT "9999"
   READ
   IF EMPTY(MCODEST) .AND. LASTKEY() = 13
      TABELA()
      IF EMPTY(MCODEST)
	 LOOP
      ENDIF
      @ 07,27 GET MCODEST PICT "9999"
      CLEAR GETS
   ELSEIF EMPTY(MCODEST) .AND. LASTKEY() = 27
      EXIT
   ENDIF
   SEEK MCODEST
   IF .NOT. FOUND()
      @ 19,15 SAY "ESTOQUE INEXISTENTE - PRESSIONE ALGO PARA CONTINUAR"
      INKEY(0)
      LOOP
   ENDIF
   @ 09,27 GET DESC 
   CLEAR GETS
   MVALUNIT = VALUNIT
   @ 11,27 GET MVALUNIT PICT "999,999.99"
   @ 13,27 GET MQUANT PICT "9999"
   READ
   M_QUANT = QUANT + MQUANT
   @ 15,27 GET M_QUANT PICT "9999"
   CLEAR GETS
   INKEY(4)
   IF .NOT. CONFIRMA("REGISTRAR ENTRADA?")
      LOOP
   ENDIF
   REPLACE QUANT   WITH M_QUANT
   REPLACE VALUNIT WITH MVALUNIT
   SELE 2
   APPEND BLANK
   REPLACE CODEST  WITH MCODEST
   REPLACE DATAE   WITH DATA_SIS
   REPLACE QTD     WITH MQUANT
   REPLACE VALUNIT WITH MVALUNIT
   REPLACE QTTOT   WITH M_QUANT
   IF CONFIRMA ("Registrar lancamento no caixa ?")
      SELE 3 
      APPEND BLANK
      REPLACE TIPO  WITH "D"
      REPLACE VALOR WITH MVALUNIT*MQUANT
      REPLACE DESC  WITH "REPOSICAO DO ESTOQUE"
   endif
   IF .NOT. CONFIRMA("DESEJA CONTINUAR?")
      EXIT
   ENDIF
ENDDO
CLOSE ALL
RETURN
* eop TMRPEST
