*******************************************************
* bop TMMTVEND                                        *
* AUTORES: ANA PAULA, DANIELLE, EVERTON,LUIZ          *
* OBJETIVO: EMITIR REGISTRO DE VENDA DE MATERIAIS     *
* DATA: 04/10/94                                      *
*******************************************************
SELE 1
   USE TMBLCD
SELE 2
   USE TMBFUN INDEX TMIFUN
SELE 3
   USE TMBCLI  INDEX TMICLI1
SELE 4
   USE TMBCOM
SELE 5
   USE TMBEST INDEX TMIEST
SELE 6
   USE TMBVEND
SELE 7
   USE TMBAGEN
SOMBRA(5,5,20,75,.F.)
@ 05,25 SAY "VENDA DE MATERIAIS"
@ 07,07 SAY "CODIGO DO CLIENTE......:"
@ 08,07 SAY "NOME DO CLIENTE........:"
@ 10,07 SAY "CODIGO DO FUNCIONARIO..:"
@ 12,07 SAY "CODIGO DO MATERIAL.....:"
@ 13,07 SAY "DESCRI€O DO MATERIAL..:"
@ 14,07 SAY "VALOR UNITARIO.........:"
@ 15,07 SAY "QUANTIDADE.............:"
@ 16,07 SAY "VALOR TOTAL............:"
SAVE SCREEN TO TELAVEND
DO WHILE .T.
   RESTORE SCREEN FROM TELAVEND
   SELE 3
   MCODCLI = 0
   @ 07,31 GET MCODCLI PICT "9999" VALID ACHACOD(MCODCLI)
   READ
   MNOMCLI = NOME
   IF LASTKEY() = 27 
      EXIT 
   ENDIF
   @ 08,31 GET MNOMCLI
   CLEAR GETS
   IF .NOT. CONFIRMA("Confirma Cliente ?")
      LOOP
   ENDIF
   SELE 2
   MCODFUNC = 0
   @ 10,31 GET MCODFUNC PICT "9999" VALID ACHACOD(MCODFUNC)
   READ
   IF LASTKEY() = 27
      EXIT
   ENDIF
   MNOME=NOMEFUN
   IF .NOT. CONFIRMA("Confirma Funcionario ?")
      LOOP
   ENDIF
   SELE 5
   MCODP = 0
   @ 12,31 GET MCODP PICT "9999" VALID ACHACOD(MCODP)
   READ
   IF LASTKEY() = 27
      EXIT
   ENDIF
   MDESC     = DESC
   MVALUNIT  = VALUNIT
   @ 13,31 GET MDESC
   @ 14,31 GET MVALUNIT PICT "999,999.99"
   CLEAR GETS
      IF .NOT. CONFIRMA("Confirma Item ?")
      LOOP
   ENDIF
   MQTDE = 0
   @ 15,31 GET MQTDE PICT "999"
   READ
   IF MQTDE > (QUANT - QTMIN)
      @ 19,15 SAY "QUANTIDADE INSUFICIENTE!"
      INKEY(4)
      LOOP
   ENDIF
   MTOTAL = MQTDE * MVALUNIT
   @ 16,31 GET MTOTAL PICT "999,999.99"
   CLEAR GETS
   INKEY(5)
   IF .NOT. CONFIRMA("CONFIRMA OS DADOS?")
       LOOP
   ENDIF
   SELE 5
   STOT = QUANT - MQTDE
   REPLACE QUANT WITH STOT
   SELE 6
   APPEND BLANK
   REPLACE CODCLI    WITH MCODCLI
   REPLACE NOMCLI    WITH MNOMCLI
   REPLACE CODFUNC   WITH MCODFUNC
   REPLACE CODMAT    WITH MCODP
   REPLACE DESCMAT   WITH MDESC
   REPLACE VALUNIT   WITH MVALUNIT
   REPLACE QTDE      WITH MQTDE
   REPLACE VALTOT    WITH MTOTAL
   REPLACE DATA      WITH DATA_SIS
   IF .NOT. CONFIRMA("PAGAMENTO A VISTA?")
      SELE 7
      MDATAPG = CTOD("  /  /  ")
      @ 19,07 SAY "DIGITE A DATA DO PAGAMENTO: " GET MDATAPG
      READ
      APPEND BLANK
      REPLACE DTA    WITH DATA_SIS
      REPLACE CODCLI WITH MCODCLI
      REPLACE NOME   WITH MNOMCLI
      REPLACE DES    WITH "VENDA DE MATERIAIS"
      REPLACE VALOR  WITH MTOTAL
      REPLACE DTPG   WITH MDATAPG
   ELSE
      SELE 1
      APPEND BLANK
      REPLACE DESC    WITH "VENDA DE MATERIAIS"
      REPLACE VALOR   WITH MTOTAL
      REPLACE TIPO    WITH "C"
   ENDIF
   IF .NOT. CONFIRMA("DESEJA CONTINUAR?")
      EXIT
   ENDIF
ENDDO
CLOSE ALL
RETURN

* EOP TMMTVEND.PRG